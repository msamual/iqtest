name: Test (Simple)

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test-docker:
    runs-on: self-hosted
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Test Docker Compose
      run: docker-compose config

    - name: Test API Docker build
      run: |
        docker build -t iq-test-api:test ./IqTestApi -f ./IqTestApi/Dockerfile.prod
        echo "✅ API Docker build successful"

    - name: Test Frontend Docker build
      run: |
        docker build -t iq-test-frontend:test ./iq-test-frontend -f ./iq-test-frontend/Dockerfile.prod
        echo "✅ Frontend Docker build successful"

    - name: Cleanup test images
      run: |
        docker rmi iq-test-api:test || true
        docker rmi iq-test-frontend:test || true
